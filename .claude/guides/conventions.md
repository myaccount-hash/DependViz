# 開発規約 - DependViz

このドキュメントはDependVizプロジェクトの開発規約を定義する。[ワークフロー](workflows.md)からこの規約を参照する。

## コメント規約

### 基本方針
- **簡潔性優先**: ロジックが本当に複雑または自明でない場合のみコメントを追加
- **自己文書化コード**: 変数名・関数名で意図を明確にし、コメントを減らす
- **既存コメントの保持**: 既存のコメントは削除しないが、必要でない限り新規追加しない

### コメントを追加すべき場合
✅ 複雑なアルゴリズムの説明
✅ 非自明な回避策（workaround）の理由
✅ パフォーマンス最適化の意図
✅ 外部APIとの統合における注意点

### コメントを避けるべき場合
❌ 自明なコードの説明（例: `setValue()` に「値を設定する」）
❌ コードと重複する情報
❌ 古くなった・不正確なコメント
❌ コメントアウトされたコード（削除すべき）

### フォーマット

**JavaScript/Node.js**:
```javascript
// 単行コメント: 簡潔な説明

/**
 * 複数行コメント/JSDoc: 複雑な関数の説明
 * @param {string} param - パラメータの説明
 * @returns {Object} 戻り値の説明
 */
```

**Java**:
```java
// 単行コメント

/**
 * Javadoc: パブリックAPIの説明
 * @param param パラメータの説明
 * @return 戻り値の説明
 */
```

## テスト規約

### 基本方針
- **手動テスト優先**: 明示的に要求されない限り自動テストを作成しない
- **実用主義**: 完璧なカバレッジより動作確認を優先
- **既存テストの維持**: 既存の手動テストチェックリストを活用

### テストを追加すべき場合
✅ ユーザが明示的に要求
✅ リグレッション防止が重要な箇所
✅ 複雑なビジネスロジック

### 手動テストチェックリスト
詳細は[開発ワークフロー - テスト](development-workflow.md#テスト)を参照。

主要な確認項目:
- グラフが2D/3Dモードで正しく表示される
- ノードクリックでファイルが開く
- フィルタが動作する
- 設定がリアルタイムで反映される

## コードレビュー規約

### レビューの観点

#### 1. 基本原則の遵守
- [ ] 簡潔性が保たれているか
- [ ] 過度な抽象化がないか
- [ ] 動作中のコードを不必要にリファクタリングしていないか

参照: [はじめに - 基本原則](getting-started.md#基本原則)

#### 2. コーディング規約の遵守
- [ ] 命名規約に従っているか
- [ ] エラーハンドリングが適切か
- [ ] ファイル構成が正しいか

参照: [コーディング規約](coding-guidelines.md)

#### 3. アーキテクチャの整合性
- [ ] 既存パターンに従っているか
- [ ] レイヤ分離が適切か
- [ ] メッセージフローが正しいか

参照: [アーキテクチャ](../reference/architecture.md)

#### 4. セキュリティ
- [ ] XSS, SQLインジェクション, コマンドインジェクションなどの脆弱性がないか
- [ ] 入力バリデーションが適切か
- [ ] 機密情報（APIキー、パスワード）がハードコードされていないか

#### 5. パフォーマンス
- [ ] 不要なループや処理がないか
- [ ] メモリリークの可能性がないか
- [ ] 大量データの処理が適切か

### レビューコメントの例

**良い例**:
```markdown
この処理は O(n²) の計算量になっています。
Map を使うことで O(n) に改善できます。

// 提案
const map = new Map();
for (const item of items) {
  map.set(item.id, item);
}
```

**悪い例**:
```markdown
このコードは良くないです。
```

## 不要コード削除の規約

### 削除すべきコード
✅ コメントアウトされたコード
✅ 使用されていない変数・関数・クラス
✅ デッドコード（到達不可能なコード）
✅ 重複したコード（統合できる場合）

### 削除前の確認
- [ ] 本当に使用されていないか全検索で確認
- [ ] 将来の実装のためのプレースホルダーではないか確認
- [ ] 削除による影響範囲を確認

### 削除時の注意
- **段階的に削除**: 一度に大量のコードを削除しない
- **コミットを分ける**: 削除のコミットと機能追加のコミットを分離
- **削除理由を記録**: コミットメッセージに理由を記載

## ドキュメント整理の規約

### 更新すべきタイミング
- [ ] 新機能追加時
- [ ] アーキテクチャ変更時
- [ ] コーディング規約変更時
- [ ] ビルドプロセス変更時

### ドキュメントメンテナンス
詳細は[ドキュメント管理ガイド](../documentation-guide.md)を参照。

チェックリスト:
- [ ] リンク切れがないか確認
- [ ] 古い情報を更新
- [ ] コード例が最新APIと一致するか確認
- [ ] バージョン番号と日付を更新

## コード更新時の共通操作

すべてのコード変更において実行すべき基本操作。

### 変更前
1. **最新コードを取得**
   ```bash
   git pull origin feature/2d-graph
   ```

2. **現在の状態を確認**
   ```bash
   git status
   git diff
   ```

### 変更中
1. **段階的に実装**: 小さな変更を行い、動作確認を繰り返す

2. **継続的にテスト**: 変更のたびに手動テストを実行

3. **リントを実行**:
   ```bash
   npm run lint
   # または自動修正
   npm run lint:fix
   ```

### 変更後
1. **ビルド確認**:
   ```bash
   # 拡張機能の場合
   npm run build

   # Webviewのみ
   npm run build:webview

   # Java LSPのみ
   npm run build:java
   ```

2. **動作確認**: 手動テストチェックリストを実行

3. **関連ドキュメント更新**: 必要に応じてドキュメントを更新

4. **コミット前の最終確認**:
   - [ ] 意図しないファイルが含まれていないか
   - [ ] デバッグコード（console.log など）が残っていないか
   - [ ] 機密情報が含まれていないか

## 関連ドキュメント

- [ワークフロー](workflows.md) - 各タスクの実行手順
- [コーディング規約](coding-guidelines.md) - 命名規則、構成原則
- [開発ワークフロー](development-workflow.md) - ビルド、テスト、デバッグ
- [はじめに](getting-started.md) - 基本原則、プロジェクト概要

---

[← 開発ワークフロー](development-workflow.md) | [ワークフロー →](workflows.md)
